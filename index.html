<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Clock</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="apple-touch-icon" href="./icon/icon-192x192.png">
    <link rel="apple-touch-startup-image" href="./icon/icon-512x512.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Stopwatch">
    <link rel="icon" type="image/png" sizes="192x192" href="./icon/icon-192x192.png">

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow-x: hidden;
            background-color: black;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            box-sizing: border-box;
        }

        *,
        *::before,
        *::after {
            box-sizing: inherit;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .time-display {
            display: flex;
            font-size: 20vw;
            font-weight: 200;
            margin: 24vh 0 15.5vh;
            line-height: 1.1;
            letter-spacing: -0.5px;
            font-feature-settings: "tnum";
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .time-part {
            display: inline-block;
            font-variant-numeric: tabular-nums;
        }

        .time-part.separator {
            margin: 0 0.05em;
            font-size: 0.8em;
            transform: translateY(-5%);
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            padding: 0 5vw;
            width: 100%;
            max-width: 400px;
            margin-bottom: 2vh;
        }

        .button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: opacity 0.3s ease;
        }

        .button::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border-radius: 50%;
            border: 2px solid;
            transition: border-color 0.3s ease;
        }
        
        /* Opacity yang sama untuk semua state normal */
        .reset,
        .lap {
            background-color: rgba(51, 51, 51, 1);
            color: white;
        }
        
        .reset::after,
        .lap::after {
            border-color: rgba(51, 51, 51, 1);
        }

        .start::after {
            border-color: rgba(49, 164, 61, 0.3);
        }

        .stop::after {
            border-color: rgba(255, 69, 58, 0.2);
        }

        /* State inactive untuk tombol Lap/Reset ketika waktu 00:00,00 */
        /* Opacity SAMA antara background dan border */
        .reset.inactive,
        .lap.inactive {
            opacity: 0.5;
            background-color: rgba(44, 44, 46, 1);
        }
        
        .reset.inactive::after,
        .lap.inactive::after {
            border-color: rgba(44, 44, 46, 1);
        }

        .indicator-dots {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .indicator-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background-color: gray;
        }

        .dot-white {
            background-color: white;
        }

        .dot-grey {
            background-color: #666;
        }

        .start {
            background-color: rgba(49, 164, 61, 0.3);
            color: #3cd14b;
        }

        .stop {
            background-color: rgba(255, 69, 58, 0.2);
            color: #FF453A;
        }

        .lap-list-container {
            width: 90%;
            max-width: 400px;
            border-top: 1px solid #333;
            margin-top: 2vh;
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 70px;
        }
        .lap-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #222;
            font-size: 1rem;
            font-weight: 500;
            color: white;
        }

        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            height: 60px;
            background-color: black;
            position: fixed;
            bottom: 0;
            left: 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            text-decoration: none;
            color: #aaa;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 400;
            text-align: center;
        }

        .nav-icon {
            width: 25px;
            height: 25px;
            background-image: var(--icon-url);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: block;
            margin-bottom: 3px;
        }

        .nav-item.active {
            color: #ffa500;
        }

        .lap-item.fastest {
            color: #3cd14b;
        }

        .lap-item.slowest {
            color: #FF453A;
        }

        @media (max-width: 600px) {
            .time-display {
                font-size: 23vw;
            }
        }
    </style>
</head>

<body>
    <div class="time-display" id="time">
        <span class="time-part number" id="min">00</span>
        <span class="time-part separator">:</span>
        <span class="time-part number" id="sec">00</span>
        <span class="time-part separator">,</span>
        <span class="time-part number" id="ms">00</span>
    </div>

    <div class="buttons">
        <div class="button reset" id="leftBtn">Lap</div>
        <div class="indicator-dots">
            <span class="indicator-dot dot-white"></span>
            <span class="indicator-dot dot-grey"></span>
        </div>
        <div class="button start" id="rightBtn">Start</div>
    </div>

    <div class="lap-list-container" id="lapList"></div>

    <nav class="bottom-nav">
        <a href="#" class="nav-item">
            <span class="nav-icon" style="--icon-url: url('./icon/world-clock1.png');"></span>
            <span class="nav-label" id="navWorldClock">World Clock</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon" style="--icon-url: url('./icon/alarms2.png');"></span>
            <span class="nav-label" id="navAlarms">Alarms</span>
        </a>
        <a href="#" class="nav-item active">
            <span class="nav-icon" style="--icon-url: url('./icon/stopwatch-icon2.png');"></span>
            <span class="nav-label" id="navStopwatch">Stopwatch</span>
        </a>
        <a href="#" class="nav-item">
            <span class="nav-icon" style="--icon-url: url('./icon/timers2.png');"></span>
            <span class="nav-label" id="navTimers">Timers</span>
        </a>
    </nav>

    <script>
        // Deteksi bahasa sistem
        const systemLanguage = navigator.language || navigator.userLanguage || 'en-US';
        const isIndonesian = systemLanguage.startsWith('id');
        const isEnglish = systemLanguage.startsWith('en');
        
        // Terjemahan berdasarkan bahasa
        const translations = {
            'id': {
                // Tombol
                'start': 'Mulai',
                'stop': 'Hentikan',
                'lap': 'Putaran',
                'reset': 'Ulangi',
                
                // Alert dan prompt
                'forcedMsEnabled': 'Angka paksa milidetik diaktifkan!',
                'forcedMsDisabled': 'Angka paksa milidetik dinonaktifkan.',
                'enterMilliseconds': 'Masukkan angka milidetik (pisahkan dengan koma jika lebih dari satu):',
                'enterValidNumbers': 'Masukkan minimal satu angka antara 00 dan 99.',
                'numbersSaved': 'angka milidetik telah disimpan.',
                
                // Lap
                'lapText': 'Putaran',
                
                // Bottom Navigation
                'worldClock': 'Jam Dunia',
                'alarms': 'Alarm',
                'stopwatch': 'Stopwatch',
                'timers': 'Timer'
            },
            'en': {
                // Buttons
                'start': 'Start',
                'stop': 'Stop',
                'lap': 'Lap',
                'reset': 'Reset',
                
                // Alerts and prompts
                'forcedMsEnabled': 'Forced milliseconds enabled!',
                'forcedMsDisabled': 'Forced milliseconds disabled.',
                'enterMilliseconds': 'Enter milliseconds (separate with commas if more than one):',
                'enterValidNumbers': 'Enter at least one number between 00 and 99.',
                'numbersSaved': 'millisecond numbers have been saved.',
                
                // Lap
                'lapText': 'Lap',
                
                // Bottom Navigation
                'worldClock': 'World Clock',
                'alarms': 'Alarms',
                'stopwatch': 'Stopwatch',
                'timers': 'Timers'
            }
        };
        
        // Pilih bahasa berdasarkan deteksi
        let lang = 'en';
        if (isIndonesian) {
            lang = 'id';
        } else if (isEnglish) {
            lang = 'en';
        }
        
        // Fungsi untuk mendapatkan teks terjemahan
        function t(key) {
            return translations[lang][key] || translations['en'][key];
        }

        let forcedMsList = [];
        let forcedMsIndex = 0;
        let forcedMs = null;
        let isForcedMsActive = false;
        let isStartedOnce = false;

        let startTime = 0;
        let elapsedTime = 0;
        let timerInterval;
        let isRunning = false;
        let lapCount = 1;

        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        const lapList = document.getElementById('lapList');

        const minEl = document.getElementById('min');
        const secEl = document.getElementById('sec');
        const msEl = document.getElementById('ms');

        // Elemen untuk bottom navigation
        const navWorldClock = document.getElementById('navWorldClock');
        const navAlarms = document.getElementById('navAlarms');
        const navStopwatch = document.getElementById('navStopwatch');
        const navTimers = document.getElementById('navTimers');

        let lapTimestamps = [];

        // Variabel untuk double click detection
        let lastClickTime = 0;
        const DOUBLE_CLICK_DELAY = 300; // ms

        // Fungsi untuk menginisialisasi semua teks berdasarkan bahasa
        function initializeLanguage() {
            // Tombol stopwatch
            leftBtn.textContent = t('lap');
            rightBtn.textContent = t('start');
            
            // Bottom navigation
            navWorldClock.textContent = t('worldClock');
            navAlarms.textContent = t('alarms');
            navStopwatch.textContent = t('stopwatch');
            navTimers.textContent = t('timers');
            
            // Update title
            document.title = t('stopwatch');
            
            // Update kelas tombol
            leftBtn.classList.remove("reset");
            leftBtn.classList.add("lap");
            rightBtn.classList.remove("stop");
            rightBtn.classList.add("start");
        }

        // Panggil fungsi inisialisasi bahasa
        initializeLanguage();

        // Fungsi untuk mengecek apakah waktu adalah 00:00,00
        function isZeroTime() {
            const totalTime = elapsedTime + (forcedMs !== null ? forcedMs * 10 : 0);
            return totalTime === 0;
        }

        // Fungsi untuk mengupdate opacity tombol kiri (Lap/Reset)
        function updateLeftButtonOpacity() {
            if (isZeroTime()) {
                leftBtn.classList.add('inactive');
            } else {
                leftBtn.classList.remove('inactive');
            }
        }

        function toggleForcedMs() {
            isForcedMsActive = !isForcedMsActive;
            if (isForcedMsActive) {
                alert(t('forcedMsEnabled'));
            } else {
                alert(t('forcedMsDisabled'));
            }
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const seconds = (totalSeconds % 60).toString().padStart(2, '0');
            const milliseconds = Math.floor((ms % 1000) / 10).toString().padStart(2, '0');
            return `${minutes}:${seconds},${milliseconds}`;
        }

        function updateTime() {
            const now = Date.now();
            elapsedTime = now - startTime;

            const totalSeconds = Math.floor(elapsedTime / 1000);
            const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            const seconds = (totalSeconds % 60).toString().padStart(2, '0');

            let milliseconds;
            if (!isRunning && forcedMs !== null) {
                milliseconds = forcedMs.toString().padStart(2, '0');
            } else {
                milliseconds = Math.floor((elapsedTime % 1000) / 10).toString().padStart(2, '0');
            }

            minEl.textContent = minutes;
            secEl.textContent = seconds;
            msEl.textContent = milliseconds;

            // Update opacity tombol kiri
            updateLeftButtonOpacity();

            if (lapList.firstChild && lapTimestamps.length > 0) {
                let lapTime;
                if (!isRunning && forcedMs !== null) {
                    lapTime = Math.floor(elapsedTime / 1000) * 1000 + forcedMs * 10 - lapTimestamps[lapTimestamps.length - 1];
                } else {
                    lapTime = elapsedTime - lapTimestamps[lapTimestamps.length - 1];
                }
                lapList.firstChild.querySelector('span:last-child').textContent = formatTime(lapTime);
            }
        }

        function startTimer() {
            if (isStartedOnce) {
                startTime = Date.now() - elapsedTime;
                isForcedMsActive = true;
            } else {
                startTime = Date.now() - elapsedTime;
                isStartedOnce = true;
            }

            timerInterval = setInterval(updateTime, 10);
            isRunning = true;

            rightBtn.textContent = t('stop');
            rightBtn.classList.remove("start");
            rightBtn.classList.add("stop");

            leftBtn.textContent = t('lap');
            leftBtn.classList.remove("reset");
            leftBtn.classList.add("lap");

            // Update opacity saat mulai
            updateLeftButtonOpacity();

            if (lapCount === 1) addLap();
        }

        function stopTimer() {
            clearInterval(timerInterval);
            isRunning = false;

            if (forcedMsList.length > 0 && forcedMsIndex < forcedMsList.length) {
                forcedMs = forcedMsList[forcedMsIndex++];
            } else {
                forcedMs = null;
            }

            updateTime();

            rightBtn.textContent = t('start');
            rightBtn.classList.remove("stop");
            rightBtn.classList.add("start");

            leftBtn.textContent = t('reset');
            leftBtn.classList.remove("lap");
            leftBtn.classList.add("reset");

            // Update opacity saat stop
            updateLeftButtonOpacity();
        }

        function resetTimer() {
            elapsedTime = 0;
            lapCount = 1;
            lapTimestamps = [];
            forcedMs = null;
            isStartedOnce = false;
            minEl.textContent = "00";
            secEl.textContent = "00";
            msEl.textContent = "00";
            lapList.innerHTML = '';

            rightBtn.textContent = t('start');
            rightBtn.classList.remove("stop");
            rightBtn.classList.add("start");

            leftBtn.textContent = t('lap');
            leftBtn.classList.remove("reset");
            leftBtn.classList.add("lap");

            // Update opacity saat reset (waktu menjadi 00:00,00)
            updateLeftButtonOpacity();
        }

        function addLap() {
            let currentElapsed;

            if (!isRunning && forcedMs !== null) {
                currentElapsed = elapsedTime + forcedMs * 10;
            } else {
                currentElapsed = elapsedTime;
            }

            const previousElapsed = lapTimestamps.length > 0 ? lapTimestamps[lapTimestamps.length - 1] : 0;
            const lapTime = currentElapsed - previousElapsed;

            lapTimestamps.push(currentElapsed);

            const formattedLapTime = formatTime(lapTime);

            const lapItem = document.createElement("div");
            lapItem.className = "lap-item";
            // Gunakan terjemahan untuk teks "Lap"
            lapItem.innerHTML = `<span>${t('lapText')} ${lapCount++}</span><span>${formattedLapTime}</span>`;
            lapItem.dataset.lapTime = lapTime;

            lapList.prepend(lapItem);

            updateLapTimes();
        }

        function updateLapTimes() {
            const laps = Array.from(lapList.querySelectorAll('.lap-item'));

            // Only color laps when there are at least 3 laps
            if (laps.length < 3) {
                laps.forEach(lap => {
                    lap.classList.remove('fastest', 'slowest');
                });
                return;
            }

            const lapTimes = laps.map(lap => parseInt(lap.dataset.lapTime));
            const fastestTime = Math.min(...lapTimes);
            const slowestTime = Math.max(...lapTimes);

            laps.forEach(lap => {
                lap.classList.remove('fastest', 'slowest');
                const time = parseInt(lap.dataset.lapTime);
                if (time === fastestTime) {
                    lap.classList.add('fastest');
                } else if (time === slowestTime) {
                    lap.classList.add('slowest');
                }
            });
        }

        // Fungsi untuk membuka prompt paksa milidetik
        function openForcedMsPrompt() {
            const input = prompt(t('enterMilliseconds'));
            if (!input) return;

            const values = input.split(",").map(v => parseInt(v.trim())).filter(v => !isNaN(v) && v >= 0 && v <= 99);

            if (values.length === 0) {
                alert(t('enterValidNumbers'));
                return;
            }

            forcedMsList = values;
            forcedMsIndex = 0;
            
            // Update opacity setelah mengatur forcedMs
            updateLeftButtonOpacity();
            
            alert(`${values.length} ${t('numbersSaved')}`);
        }

        // Event listener untuk double click pada milidetik
        msEl.addEventListener('click', (e) => {
            const currentTime = new Date().getTime();
            const timeSinceLastClick = currentTime - lastClickTime;
            
            if (timeSinceLastClick < DOUBLE_CLICK_DELAY && timeSinceLastClick > 0) {
                // Ini adalah double click
                e.preventDefault();
                openForcedMsPrompt();
                lastClickTime = 0; // Reset setelah double click
            } else {
                // Ini adalah single click (belum tentu)
                lastClickTime = currentTime;
                
                // Gunakan timeout untuk menunggu apakah ada click kedua
                setTimeout(() => {
                    // Jika setelah timeout tidak ada click kedua, reset
                    if (lastClickTime !== 0 && new Date().getTime() - lastClickTime >= DOUBLE_CLICK_DELAY) {
                        lastClickTime = 0;
                    }
                }, DOUBLE_CLICK_DELAY);
            }
        });

        // Event listener untuk tombol kanan (Start/Stop)
        rightBtn.addEventListener('click', () => {
            isRunning ? stopTimer() : startTimer();
        });

        // Event listener untuk tombol kiri (Lap/Reset)
        leftBtn.addEventListener('click', () => {
            // Cek jika tombol dalam state inactive (waktu 00:00,00)
            if (leftBtn.classList.contains('inactive')) {
                return; // Jangan lakukan apa-apa jika tombol disabled
            }
            isRunning ? addLap() : resetTimer();
        });

        // Inisialisasi opacity awal (waktu 00:00,00)
        updateLeftButtonOpacity();
        
        // Log bahasa yang terdeteksi (untuk debugging)
        console.log('System language detected:', systemLanguage);
        console.log('Using language:', lang);
    </script>
</body>

</html>

